!function(e,t){"use strict";function o(e){throw new Error(s.text.prefix+"Error: "+e)}function n(e,t,n,i,r){switch(e&&t||o('Argument "$toast" or "type" is not provided in $toastErr.'),n||console.log(s.text.prefix+"Caution: No toast content provided."),n=n||"（木有提供提示消息~）",r=r||void 0,t){case"simple":e.showSimpleToast(n);break;case"action":i?void 0:o('Please provide parama "action" when calling '+r),e.showActionToast(n,i,r)}}function i(e,t,i,r){n(e,"action",t,i,function(){o(r)})}function r(e,t){r.isRunning=!0,e.style.backgroundPositionX=t.startPosition+"px";var o=1,n=setInterval(function(){return o>t.step?(void 0!=t.endPosition?e.style.backgroundPositionX=t.endPosition+"px":void 0,clearInterval(n),void(r.isRunning=!1)):(e.style.backgroundPositionX=t.startPosition+t.width*o+"px",void o++)},t.interval)}function a(e,t){return!!e.className.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}function c(e,t){a(e,t)||(e.className+=" "+t)}!function(){function o(){throw e.location.href="/old-browser",new Error("Animation Searcher Error: Your Browser is too old, time to change! :)")}if(!t)throw new Error("Animation Searcher Error: Please make sure Angular.JS is loaded Correctly.");var n=e.navigator.userAgent,i=/MSIE [1-8].*]/i;n.match(i)?o():void 0}();var s={text:{prefix:"Animation Searcher "},site:{caso:{name:"华盟",codeName:"caso",fullName:"China Animation Subtitle Organization",url:"https://camoe.org",icon:"http://tp4.sinaimg.cn/1843885343/180/1290319229/0",disabled:!1},ktxp:{name:"极影",codeName:"ktxp",fullName:"Katong XP",url:"http://bt.ktxp.org",icon:"http://tp4.sinaimg.cn/3808818207/180/5680524263/0",disabled:!1},popgo:{name:"漫游",codeName:"popgo",fullName:"Popgo",url:"http://share.popgo.com",icon:"http://tp1.sinaimg.cn/2661910672/180/5727241391/0",disabled:!1},dmhy:{name:"动漫花园",codeName:"dmhy",fullName:"DongMan HuaYuan",url:"http://share.dmhy.org",icon:"http://tp2.sinaimg.cn/1926582581/180/22817929400/0",disabled:!1}},toast:{position:{top:!0,bottom:!1,left:!1,right:!0}}};r.isRunning=!1;var l=t.module("ngApp",["ngAnimate","ngMaterial","ngSanitize","ngRoute","ngAppCtrls","ngAppDirectives","ngAppToast","ngCharMsg","ngLeftNav","ngColorChange","ngLocalStorage"]),u=t.module("ngAppCtrls",[]);u.config(["$compileProvider",function(e){e.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|magnet):/)}]);var m=t.module("ngAppDirectives",[]),d=t.module("ngAppToast",[]);d.factory("$toast",function(e){var t={};return t.toastPosition=s.toast.position,t.getToastPosition=function(){return Object.keys(t.toastPosition).filter(function(e){return t.toastPosition[e]}).join(" ")},t.showSimpleToast=function(o){e.show(e.simple().content(o).position(t.getToastPosition()).hideDelay(5e3))},t.showActionToast=function(o,n,i){i=i||function(){};var r=e.simple().content(o).action(n).highlightAction(!1).position(t.getToastPosition());e.show(r).then(i)},t.closeToast=function(){e.hide()},t});var f=t.module("ngCharMsg",[]);f.factory("$charMsg",function(e,n){var i=t.element(document.querySelector("body")),r=!1,a=null,s=null,l={create:function(t,n,s){if(n||o('param "content" must be provided when calling "$charMsg.show()".'),a&&o("\n\n Character Message Panel has been created, can't create anymore, so stop calling me before remove it! （╯－＿－）╯╧╧ \n"),!r){r=!0,a=document.createElement("char-msg"),a.className="char-msg";var u=document.createElement("div");switch(u.className="char-msg-container",s=s||"left"){case"left":c(a,"left");break;case"right":c(a,"right")}if(t){var m=document.createElement("h2");m.className="char-msg-title",m.innerHTML=t,u.appendChild(m)}var d=document.createElement("div");d.className="char-msg-content",d.innerHTML=n,u.appendChild(d);var f=document.createElement("button");f.className="char-msg-close-btn",f.onclick=l.remove;var p=document.createElement("i");p.className="icon-cancel",f.appendChild(p),u.appendChild(f),a.appendChild(u),i.append(a),e(function(){r=!1},500)}},remove:function(t){console.log(n),c(a,"out-animation"),s=e(function(){a.parentNode.removeChild(a),a=null},500)}};return{show:l.create,hide:l.remove}});var p=t.module("ngLocalStorage",[]);p.factory("$localStorage",function(t){function n(t,n){t&&n||o('Params must be provided when calling "$localStorage.setItem()"!  (╯‵□′)╯︵┻━┻'),"[object String]"!==Object.prototype.toString.call(t)&&o('$localStorage.setItem(): Param "key" must be String.'),e.localStorage.setItem(t,n)}function i(t){return t&&"[object String]"===Object.prototype.toString.call(t)||o('$localStorage.getItem(): Params "key" is invalid, take a look.'),e.localStorage.getItem(t)}function r(t){t&&"[object String]"===Object.prototype.toString.call(t)||o('$localStorage.removeItem(): Params "key" is invalid, take a look.'),e.localStorage.removeItem(t)}function a(){Object.keys(e.localStorage).filter(function(e){r(e)}),t.showSimpleToast("搜索历史已成功清空!  (●'◡'●)ﾉ♥"),console.log(s.text.prefix+"Info:\nAll items in Local Storage has been removed at "+new Date(Date.now())+".")}return{setItem:n,getItem:i,removeItem:r,empty:a}});var g=t.module("ngLeftNav",[]);g.factory("$leftNav",function(o,n,i){function a(e){27===e.keyCode&&(m(),l())}function c(){f.unbind("keyup",a)}function s(){o("leftside").toggle().then(function(){}),n(function(){var e=t.element(document.querySelector("md-backdrop"));e.unbind(),n(function(){e.bind("click",d)},400),o("leftside").isOpen()&&f.bind("keyup",a)},1)}function l(){o("leftside").close(),m("close")}function u(){o("leftside").isOpen()||(s(),m("open"),n(function(){var e=t.element(document.querySelector("md-backdrop"));e.removeClass("ng-enter")},1))}function m(e){var t=document.getElementById("left-nav-menu"),o={toArrow:function(){var e={startPosition:0,width:27.75,step:16,interval:17};r(t,e),t.setAttribute("data-status","arrow"),i.path("/side-nav-open")},toMenu:function(){var e={startPosition:444,endPosition:0,width:27.75,step:16,interval:17};r(t,e),t.setAttribute("data-status","menu"),c(),i.path("/")}},n=t.getAttribute("data-status");if(e)switch(e){case"open":if("arrow"===n)return;o.toArrow();break;case"close":if("menu"===n)return;o.toMenu()}else switch(n){case"menu":o.toArrow();break;case"arrow":o.toMenu()}}function d(){return r.isRunning?!1:(s(),void m())}var f=t.element(e);return{toggle:d,open:u,close:l}});var h=t.module("ngColorChange",[]);h.factory("$colorChange",function(){function e(e){var t=".color-theme.bk-color {background-color:"+e+"}.color-theme.text-color {color:"+e+"}";n.html(t)}var o=document.getElementById("color-change"),n=t.element(o);return{change:e}}),l.config(["$routeProvider",function(e){e.when("/change-log",{template:"",controller:function(e,t,o,n){t.post("/change-log").then(function(e){n.show(e.data.title,e.data.content)},function(e){i(o,"更新日志获取失败, 过一会再试试?","(/= _ =)/~┴┴","Request for Change Log failed.")})}}).when("/side-nav-open",{template:"",controller:function(e){e.open()}}).when("/",{template:"",controller:function(e){e.close()}})}]).config(["$locationProvider",function(e){e.html5Mode({enabled:!0})}]),u.controller("mainController",["$scope","$rootScope",function(e,t){e.progressStatus={},function(){Object.keys(s.site).filter(function(t){e.progressStatus[t]=!1})}(),e.searchResult={}}]),u.controller("leftNavButtonCtrl",function(e,t,o,n,i,r){e.clearHistory=function(){r.empty()}}),m.directive("actionBar",function(){return{restrict:"E",scope:{},controller:function(e,t,o){},link:function(e,t,o){}}}),m.directive("leftnavMenu",function(e){return{restrict:"E",scope:!0,controller:function(e,t,o){},link:function(t,o,n){t.toggle=e.toggle}}}),m.directive("searchBar",function(e){return{restrict:"E",scope:!0,controller:function(e,t,o,n){},link:function(t,o,n){t.keywords=null,t.searchExec=function(){Object.keys(s.site).filter(function(o){$http.post("/search/"+s.site[o].codeName,{keywords:t.keywords}).success(function(t,n,i,r){$scope.searchResult[o]=t.result,e.toast.showSimpleToast(t.info)}).error(function(t,o,n,i){e.toast.showActionToast(t.info,t.action)})})}}}}),m.directive("siteSwitcher",function(){return{restrict:"E",scope:!0,replace:!0,templateUrl:"/templates/ng-site-switcher.html",controller:function(e,t,n){e.panelSwitch=function(e){e?void 0:o('Please provide param "codeName" while calling this function.')}},link:function(e,t,o){e.switcherList=s.site,Object.keys(e.switcherList).filter(function(t){e.switcherList[t].title="切换至"+e.switcherList[t].name+"的搜索结果"})}}}),m.directive("resultPanel",function(){return{restrict:"E",scope:!0,templateUrl:"/templates/ng-result-panel.html",controller:function(e,t,n,i,r,a){n.codename?void 0:o('Attribute "codename" must be defined.');var c=n.codename;e.domInfo={codeName:c,name:s.site[c].name,fullName:s.site[c].fullName,icon:s.site[c].icon,disabled:s.site[c].disabled},e.result=e.searchResult},link:function(e,t,n){n.codename?void 0:o('Attribute "codename" must be defined.')}}})}(window,window.angular),function(e,t,o){function n(){if(!e.io)throw new Error(i+"Error: Socket.io isn't loaded yet, scripts has been stoped.");var t=e.io();t.on("greeting",function(e){console.log(i+"Info: WebSocket from now on. :)"),t.emit("thank-you-sir",{info:"啊♂啊♂Thank♂You♂Sir"})})}var i="Animation Searcher ";t.element(window).on("load",n)}(window,window.angular);