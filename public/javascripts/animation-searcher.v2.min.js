!function(t,e){function n(){throw t.location.href="/old-browser",new Error("Animation Searcher Error: Your Browser is too old, time to change! :)")}if(!angular)throw new Error("Animation Searcher Error: Please make sure Angular.JS is loaded Correctly.");var o=t.navigator.userAgent,r=/MSIE [1-8].*]/i;o.match(r)?n():void 0}(window),function(){"use strict";var t=angular.module("appConfig",[]);t.value("appConfig",{text:{prefix:"Animation Searcher "},site:{caso:{name:"华盟",codeName:"caso",fullName:"China Animation Subtitle Organization",url:"https://camoe.org",icon:"http://tp4.sinaimg.cn/1843885343/180/1290319229/0",disabled:!1},ktxp:{name:"极影",codeName:"ktxp",fullName:"Katong XP",url:"http://bt.ktxp.org",icon:"http://tp4.sinaimg.cn/3808818207/180/5680524263/0",disabled:!1},popgo:{name:"漫游",codeName:"popgo",fullName:"Popgo",url:"http://share.popgo.com",icon:"http://tp1.sinaimg.cn/2661910672/180/5727241391/0",disabled:!1},dmhy:{name:"动漫花园",codeName:"dmhy",fullName:"DongMan HuaYuan",url:"http://share.dmhy.org",icon:"http://tp2.sinaimg.cn/1926582581/180/22817929400/0",disabled:!1}},toast:{position:{top:!0,bottom:!1,left:!1,right:!0}}})}(),function(){"use strict";var t=angular.module("ngApp",["ngAnimate","ngMaterial","ngSanitize","ngRoute","appConfig","internalFunc","ngAppCtrls","ngAppDirectives","colorThief","appToast","charMsg","leftNav","colorChange","localStorage","splashLayout","splashScreen","changeLog","textPanel","clearMdToast"]);t.run(["$timeout","$splashScreen","$colorChange","$colorThief",function(t,e,n,o){angular.element(window).on("load",function(){var r=o.getDarkestColor(document.querySelector("#greeting-background"));t(function(){e.hide()},3e3),t(function(){n.change(r)},1e3)})}])}(),function(){var t=angular.module("colorThief",[]);t.factory("$colorThief",function(){var t=function(t){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),document.body.appendChild(this.canvas),this.width=this.canvas.width=t.width,this.height=this.canvas.height=t.height,this.context.drawImage(t,0,0,this.width,this.height)};t.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},t.prototype.update=function(t){this.context.putImageData(t,0,0)},t.prototype.getPixelCount=function(){return this.width*this.height},t.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)},t.prototype.removeCanvas=function(){this.canvas.parentNode.removeChild(this.canvas)};var e=function(){};if(e.prototype.getColor=function(t,e){var n=this.getPalette(t,5,e);return"rgb("+n[0][0]+", "+n[0][1]+", "+n[0][2]+")"},e.prototype.getDarkestColor=function(t,e){var n=this.getPalette(t,5,e),o=765,r=null;return Object.keys(n).filter(function(t){var e=n[t][0]+n[t][1]+n[t][2];o>e&&(o=e,r="rgb("+n[t][0]+", "+n[t][1]+", "+n[t][2]+")")}),r},e.prototype.getPalette=function(e,n,r){"undefined"==typeof n&&(n=10),("undefined"==typeof r||1>r)&&(r=10);for(var a,i,c,s,l,u=new t(e),f=u.getImageData(),h=f.data,d=u.getPixelCount(),p=[],m=0;d>m;m+=r)a=4*m,i=h[a+0],c=h[a+1],s=h[a+2],l=h[a+3],l>=125&&(i>250&&c>250&&s>250||p.push([i,c,s]));var g=o.quantize(p,n),v=g?g.palette():null;return u.removeCanvas(),v},!n)var n={map:function(t,e){var n={};return e?t.map(function(t,o){return n.index=o,e.call(n,t)}):t.slice()},naturalOrder:function(t,e){return e>t?-1:t>e?1:0},sum:function(t,e){var n={};return t.reduce(e?function(t,o,r){return n.index=r,t+e.call(n,o)}:function(t,e){return t+e},0)},max:function(t,e){return Math.max.apply(null,e?n.map(t,e):t)}};var o=function(){function t(t,e,n){return(t<<2*l)+(e<<l)+n}function e(t){function e(){n.sort(t),o=!0}var n=[],o=!1;return{push:function(t){n.push(t),o=!1},peek:function(t){return o||e(),void 0===t&&(t=n.length-1),n[t]},pop:function(){return o||e(),n.pop()},size:function(){return n.length},map:function(t){return n.map(t)},debug:function(){return o||e(),n}}}function o(t,e,n,o,r,a,i){var c=this;c.r1=t,c.r2=e,c.g1=n,c.g2=o,c.b1=r,c.b2=a,c.histo=i}function r(){this.vboxes=new e(function(t,e){return n.naturalOrder(t.vbox.count()*t.vbox.volume(),e.vbox.count()*e.vbox.volume())})}function a(e){var n,o,r,a,i=1<<3*l,c=new Array(i);return e.forEach(function(e){o=e[0]>>u,r=e[1]>>u,a=e[2]>>u,n=t(o,r,a),c[n]=(c[n]||0)+1}),c}function i(t,e){var n,r,a,i=1e6,c=0,s=1e6,l=0,f=1e6,h=0;return t.forEach(function(t){n=t[0]>>u,r=t[1]>>u,a=t[2]>>u,i>n?i=n:n>c&&(c=n),s>r?s=r:r>l&&(l=r),f>a?f=a:a>h&&(h=a)}),new o(i,c,s,l,f,h,e)}function c(e,o){function r(t){var e,n,r,a,i,c=t+"1",s=t+"2",u=0;for(l=o[c];l<=o[s];l++)if(m[l]>p/2){for(r=o.copy(),a=o.copy(),e=l-o[c],n=o[s]-l,i=n>=e?Math.min(o[s]-1,~~(l+n/2)):Math.max(o[c],~~(l-1-e/2));!m[i];)i++;for(u=g[i];!u&&m[i-1];)u=g[--i];return r[s]=i,a[c]=r[s]+1,[r,a]}}if(o.count()){var a=o.r2-o.r1+1,i=o.g2-o.g1+1,c=o.b2-o.b1+1,s=n.max([a,i,c]);if(1==o.count())return[o.copy()];var l,u,f,h,d,p=0,m=[],g=[];if(s==a)for(l=o.r1;l<=o.r2;l++){for(h=0,u=o.g1;u<=o.g2;u++)for(f=o.b1;f<=o.b2;f++)d=t(l,u,f),h+=e[d]||0;p+=h,m[l]=p}else if(s==i)for(l=o.g1;l<=o.g2;l++){for(h=0,u=o.r1;u<=o.r2;u++)for(f=o.b1;f<=o.b2;f++)d=t(u,l,f),h+=e[d]||0;p+=h,m[l]=p}else for(l=o.b1;l<=o.b2;l++){for(h=0,u=o.r1;u<=o.r2;u++)for(f=o.g1;f<=o.g2;f++)d=t(u,f,l),h+=e[d]||0;p+=h,m[l]=p}return m.forEach(function(t,e){g[e]=p-t}),r(s==a?"r":s==i?"g":"b")}}function s(t,o){function s(t,e){for(var n,o=1,r=0;f>r;)if(n=t.pop(),n.count()){var a=c(l,n),i=a[0],s=a[1];if(!i)return;if(t.push(i),s&&(t.push(s),o++),o>=e)return;if(r++>f)return}else t.push(n),r++}if(!t.length||2>o||o>256)return!1;var l=a(t),u=0;l.forEach(function(){u++});var d=i(t,l),p=new e(function(t,e){return n.naturalOrder(t.count(),e.count())});p.push(d),s(p,h*o);for(var m=new e(function(t,e){return n.naturalOrder(t.count()*t.volume(),e.count()*e.volume())});p.size();)m.push(p.pop());s(m,o-m.size());for(var g=new r;m.size();)g.push(m.pop());return g}var l=5,u=8-l,f=1e3,h=.75;return o.prototype={volume:function(t){var e=this;return(!e._volume||t)&&(e._volume=(e.r2-e.r1+1)*(e.g2-e.g1+1)*(e.b2-e.b1+1)),e._volume},count:function(e){var n=this,o=n.histo;if(!n._count_set||e){var r,a,i,c=0;for(r=n.r1;r<=n.r2;r++)for(a=n.g1;a<=n.g2;a++)for(i=n.b1;i<=n.b2;i++)index=t(r,a,i),c+=o[index]||0;n._count=c,n._count_set=!0}return n._count},copy:function(){var t=this;return new o(t.r1,t.r2,t.g1,t.g2,t.b1,t.b2,t.histo)},avg:function(e){var n=this,o=n.histo;if(!n._avg||e){var r,a,i,c,s,u=0,f=1<<8-l,h=0,d=0,p=0;for(a=n.r1;a<=n.r2;a++)for(i=n.g1;i<=n.g2;i++)for(c=n.b1;c<=n.b2;c++)s=t(a,i,c),r=o[s]||0,u+=r,h+=r*(a+.5)*f,d+=r*(i+.5)*f,p+=r*(c+.5)*f;u?n._avg=[~~(h/u),~~(d/u),~~(p/u)]:n._avg=[~~(f*(n.r1+n.r2+1)/2),~~(f*(n.g1+n.g2+1)/2),~~(f*(n.b1+n.b2+1)/2)]}return n._avg},contains:function(t){var e=this,n=t[0]>>u;return gval=t[1]>>u,bval=t[2]>>u,n>=e.r1&&n<=e.r2&&gval>=e.g1&&gval<=e.g2&&bval>=e.b1&&bval<=e.b2}},r.prototype={push:function(t){this.vboxes.push({vbox:t,color:t.avg()})},palette:function(){return this.vboxes.map(function(t){return t.color})},size:function(){return this.vboxes.size()},map:function(t){for(var e=this.vboxes,n=0;n<e.size();n++)if(e.peek(n).vbox.contains(t))return e.peek(n).color;return this.nearest(t)},nearest:function(t){for(var e,n,o,r=this.vboxes,a=0;a<r.size();a++)n=Math.sqrt(Math.pow(t[0]-r.peek(a).color[0],2)+Math.pow(t[1]-r.peek(a).color[1],2)+Math.pow(t[2]-r.peek(a).color[2],2)),(e>n||void 0===e)&&(e=n,o=r.peek(a).color);return o},forcebw:function(){var t=this.vboxes;t.sort(function(t,e){return n.naturalOrder(n.sum(t.color),n.sum(e.color))});var e=t[0].color;e[0]<5&&e[1]<5&&e[2]<5&&(t[0].color=[0,0,0]);var o=t.length-1,r=t[o].color;r[0]>251&&r[1]>251&&r[2]>251&&(t[o].color=[255,255,255])}},{quantize:s}}();return new e})}(),function(){"use strict";var t=angular.module("ngAppCtrls",[]);t.config(["$compileProvider",function(t){t.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|magnet):/)}]).controller("mainController",["$scope","$rootScope","$location","$timeout","appConfig","$splashLayout",function(t,e,n,o,r,a){t.splashLayout=a,t.layout=a.layout.status,t.$watch("splashLayout",function(e,n){t.layout=e.layout.status},!0),t.$on("splashScreen",function(e,n){o(function(){t.backgroundBlur="blur"},1e3)}),t.progressStatus={},function(){Object.keys(r.site).filter(function(e){t.progressStatus[e]=!1})}(),t.searchResult={}}]),t.controller("searchController",["$scope",function(t){function e(){}function n(){}function o(){}t.searchBarFocus=e,t.searchBarBlur=n,t.searchBarKeyDown=o}]),t.controller("leftNavButtonCtrl",["$scope","$http","$toast","$leftNav","$charMsg","$localStorage",function(t,e,n,o,r,a){t.clearHistory=function(){a.empty()}}]),t.controller("splashScreenController",["$scope",function(t){t.status=null,t.$on("splashScreen",function(e,n){t.status=n})}])}(),function(){"use strict";var t=angular.module("ngAppDirectives",[]);t.directive("actionBar",function(){return{restrict:"E",scope:{},controller:function(t,e,n){},link:function(t,e,n){}}}),t.directive("leftnavMenu",["$leftNav",function(t){return{restrict:"E",scope:!0,controller:function(t,e,n){},link:function(e,n,o){e.toggle=t.toggle}}}]),t.directive("searchBar",function(t){return{restrict:"E",scope:!0,controller:function(t,e,n,o){},link:function(e,n,o){e.keywords=null,e.searchExec=function(){Object.keys(moduleSettings.site).filter(function(n){$http.post("/search/"+moduleSettings.site[n].codeName,{keywords:e.keywords}).success(function(e,o,r,a){$scope.searchResult[n]=e.result,t.toast.showSimpleToast(e.info)}).error(function(e,n,o,r){t.toast.showActionToast(e.info,e.action)})})}}}}),t.directive("siteSwitcher",function(){return{restrict:"E",scope:!0,replace:!0,templateUrl:"/templates/ng-site-switcher.html",controller:function(t,e,n){t.panelSwitch=function(t){t?void 0:throwError('Please provide param "codeName" while calling this function.')}},link:function(t,e,n){t.switcherList=moduleSettings.site,Object.keys(t.switcherList).filter(function(e){t.switcherList[e].title="切换至"+t.switcherList[e].name+"的搜索结果"})}}}),t.directive("resultPanel",function(){return{restrict:"E",scope:!0,templateUrl:"/templates/ng-result-panel.html",controller:function(t,e,n,o,r,a){n.codename?void 0:throwError('Attribute "codename" must be defined.');var i=n.codename;t.domInfo={codeName:i,name:moduleSettings.site[i].name,fullName:moduleSettings.site[i].fullName,icon:moduleSettings.site[i].icon,disabled:moduleSettings.site[i].disabled},t.result=t.searchResult},link:function(t,e,n){n.codename?void 0:throwError('Attribute "codename" must be defined.')}}}),t.directive("textPanel",["$compile","$timeout","$window","$toast","$clearMDToast",function(t,e,n,o,r){return{restrict:"E",controller:["$scope","$element","$attrs",function(t,e,n){}],link:function(a,i,c){function s(c){c.content?void 0:o.showSimpleToast("Caution: No content provided.");var s='<div class="main-container w-100 h-100 p-absolute p-zero bk-merge md-whiteframe-4dp" style="z-index: 10000"><div class="content-container p-relative"><h2 class="title color-theme bk-color">'+c.title+'</h2><md-button class="md-icon-button close-btn transition-dot-4" style="margin-top: .5em;" ng-click="closePanel()" aria-label="Close this panel."><md-tooltip>关闭面板</md-tooltip><i class="icon-cancel"></i></md-button><div class="content">'+c.content+"</div></div></div>";i.append(t(s)(a)),a.panelStatus="in",a.closePanel=function(){c.backward?n.history.back():void 0,a.panelStatus="out",e(function(){angular.element(i).empty(),r()},600)}}a.closePanel=null,a.panelStatus="out",a.$on("textPanelCreated",function(t,e){s(e)})}}}])}(),function(){"use strict";function t(t){throw new Error(moduleSettings.text.prefix+"Error: "+t)}function e(e,n,o,r,a){switch(e&&n||t('Argument "$toast" or "type" is not provided in $toastErr.'),o||console.log(moduleSettings.text.prefix+"Caution: No toast content provided."),o=o||"（木有提供提示消息~）",a=a||void 0,n){case"simple":e.showSimpleToast(o);break;case"action":r?void 0:t('Please provide parama "action" when calling '+a),e.showActionToast(o,r,a)}}function n(n,o,r,a){e(n,"action",o,r,function(){t(a)})}function o(t,e){o.isRunning=!0,t.style.backgroundPositionX=e.startPosition+"px";var n=1,r=setInterval(function(){return n>e.step?(void 0!=e.endPosition?t.style.backgroundPositionX=e.endPosition+"px":void 0,clearInterval(r),void(o.isRunning=!1)):(t.style.backgroundPositionX=e.startPosition+e.width*n+"px",void n++)},e.interval)}function r(t,e){return!!t.className.match(new RegExp("(\\s|^)"+e+"(\\s|$)"))}function a(t,e){r(t,e)||(t.className+=" "+e)}function i(t,e){r(t,e)&&(t.className=t.className.replace(new RegExp("(\\s|^)"+e+"(\\s|$)")," "))}function c(t,e){t.className=e}function s(t,e){return t.firstChild?t.insertBefore(e,t.firstChild):t.appendChild(e),t}var l=angular.module("internalFunc",[]);l.factory("$internalFunc",function(){return{throwError:t,toastFunc:e,toastErr:n,imageAnimationX:o,hasClass:r,addClass:a,removeClass:i,setClass:c,prependChild:s}}),o.isRunning=!1}(),function(){"use strict";var t=angular.module("ngApp");t.config(["$routeProvider",function(t){t.when("/change-log",{template:"",controller:function(t){t.show()}}).when("/welcome",{template:"",controller:function(t){t.toInitLayout()}}).when("/stand-by",{template:"",controller:function(t){t.toStandByLayout()}}).when("/side-nav-open",{template:"",controller:function(t,e){t.open(),e.toStandByLayout()}}).when("/powered-by",{template:"",controller:function(t){t.show("Powered By ...","This site is powered by Angular.JS, Node.JS, Nginx @ Aliyun.")}}).when("/",{template:"",controller:function(t,e){t.close()}}).otherwise({redirectTo:"/"})}]).config(["$locationProvider",function(t){t.html5Mode({enabled:!0})}])}(),function(t,e){"use strict";var n=angular.module("appToast",[]);n.factory("$toast",["$mdToast","appConfig",function(t,e){var n={};return n.toastPosition=e.toast.position,n.getToastPosition=function(){return Object.keys(n.toastPosition).filter(function(t){return n.toastPosition[t]}).join(" ")},n.showSimpleToast=function(e){t.show(t.simple().content(e).position(n.getToastPosition()).hideDelay(5e3))},n.showActionToast=function(e,o,r){r=r||function(){};var a=t.simple().content(e).action(o).highlightAction(!1).position(n.getToastPosition());t.show(a).then(r)},n.closeToast=function(){t.hide()},n}]);var o=angular.module("charMsg",[]);o.factory("$charMsg",["$timeout","$window","$internalFunc",function(t,e,n){var o=angular.element(document.querySelector("body")),r=!1,a=null,i=null,c={create:function(e,i,s){if(i||n.throwError('param "content" must be provided when calling "$charMsg.show()".'),a&&n.throwError("\n\n Character Message Panel has been created, can't create anymore, so stop calling me before remove it! （╯－＿－）╯╧╧ \n"),!r){r=!0,a=document.createElement("char-msg"),a.className="char-msg";var l=document.createElement("div");switch(l.className="char-msg-container",s=s||"left"){case"left":n.addClass(a,"left");break;case"right":n.addClass(a,"right")}if(e){var u=document.createElement("h2");u.className="char-msg-title",u.innerHTML=e,l.appendChild(u)}var f=document.createElement("div");f.className="char-msg-content",f.innerHTML=i,l.appendChild(f);var h=document.createElement("button");h.className="char-msg-close-btn",h.onclick=c.remove;var d=document.createElement("i");d.className="icon-cancel",h.appendChild(d),l.appendChild(h),a.appendChild(l),o.append(a),t(function(){r=!1},500)}},remove:function(){n.addClass(a,"out-animation"),e.history.back(),i=t(function(){a.parentNode.removeChild(a),a=null},500)}};return{show:c.create,hide:c.remove}}]);var r=angular.module("localStorage",[]);r.factory("$localStorage",function(e,n,o){function r(e,o){e&&o||n.throwError('Params must be provided when calling "$localStorage.setItem()"!  (╯‵□′)╯︵┻━┻'),"[object String]"!==Object.prototype.toString.call(e)&&n.throwError('$localStorage.setItem(): Param "key" must be String.'),t.localStorage.setItem(e,o)}function a(e){return e&&"[object String]"===Object.prototype.toString.call(e)||n.throwError('$localStorage.getItem(): Params "key" is invalid, take a look.'),t.localStorage.getItem(e)}function i(e){e&&"[object String]"===Object.prototype.toString.call(e)||n.throwError('$localStorage.removeItem(): Params "key" is invalid, take a look.'),t.localStorage.removeItem(e)}function c(){Object.keys(t.localStorage).filter(function(t){i(t)}),e.showSimpleToast("搜索历史已成功清空!  (●'◡'●)ﾉ♥"),console.log(o.text.prefix+"Info:\nAll items in Local Storage has been removed at "+new Date(Date.now())+".")}return{setItem:r,getItem:a,removeItem:i,empty:c}});var a=angular.module("leftNav",[]);a.factory("$leftNav",function(e,n,o,r){function a(t){27===t.keyCode&&(u(),s())}function i(){h.unbind("keyup",a)}function c(){e("leftside").toggle().then(function(){}),n(function(){var t=angular.element(document.querySelector("md-backdrop"));t.unbind(),n(function(){t.bind("click",f)},400),e("leftside").isOpen()&&h.bind("keyup",a)},1)}function s(){e("leftside").close(),u("close")}function l(){e("leftside").isOpen()||(c(),u("open"),n(function(){var t=angular.element(document.querySelector("md-backdrop"));t.removeClass("ng-enter")},1))}function u(t){var e=document.getElementById("left-nav-menu"),n={toArrow:function(){var t={startPosition:0,width:27.75,step:16,interval:17};r.imageAnimationX(e,t),e.setAttribute("data-status","arrow"),o.path("/side-nav-open")},toMenu:function(){var t={startPosition:444,endPosition:0,width:27.75,step:16,interval:17};r.imageAnimationX(e,t),e.setAttribute("data-status","menu"),i(),o.path("/")}},a=e.getAttribute("data-status");if(t)switch(t){case"open":if("arrow"===a)return;n.toArrow();break;case"close":if("menu"===a)return;n.toMenu()}else switch(a){case"menu":n.toArrow();break;case"arrow":n.toMenu()}}function f(){return r.imageAnimationX.isRunning?!1:(c(),void u())}var h=angular.element(t);return{toggle:f,open:l,close:s}});var i=angular.module("colorChange",[]);i.factory("$colorChange",function(){function t(t){var e=".color-theme.bk-color {background-color:"+t+"}.color-theme.text-color {color:"+t+" !important}";n.html(e)}var e=document.getElementById("color-change"),n=angular.element(e);return{change:t}});var c=angular.module("splashLayout",[]);c.factory("$splashLayout",function(){function t(){o.status=n.initLayout}function e(){o.status=n.standBy}var n={initLayout:"init-layout",standBy:"stand-by-layout"},o={status:n.initLayout};return{toInitLayout:t,toStandByLayout:e,layout:o}});var s=angular.module("changeLog",[]);s.factory("$changeLog",["$http","$splashLayout","$leftNav","$toast","$internalFunc","$textPanel",function(t,e,n,o,r,a){function i(){t.post("/change-log").then(function(t){a.show({title:"更新日志 <small>Change Log.</small>",content:t.data.content,backward:!0})},function(t){r.toastErr(o,"更新日志获取失败, 过一会再试试?","(/= _ =)/~┴┴","Request for Change Log failed.")})}return{show:i}}]);var l=angular.module("textPanel",[]);l.factory("$textPanel",["$rootScope",function(t){function e(){console.log("$textPanel Service: \n--- This is a invincible divider. ---"),console.log(' - $textPanel.show(config): Create a text panel and fill it with "content".'),console.log(" - $textPanel.help(): Here comes the help you loser! \n")}function n(e){e=e||"",t.$broadcast("textPanelCreated",e)}return{show:n,help:e}}]);var u=angular.module("clearMdToast",[]);u.factory("$clearMDToast",function(){return function(){angular.element(document.querySelector(".md-content")).remove()}});var f=angular.module("splashScreen",[]);f.factory("$splashScreen",["$rootScope",function(t){function e(){t.$broadcast("splashScreen",arguments[0])}return{show:e.bind(0,"show"),hide:e.bind(0,"hide")}}])}(window),function(t,e,n){function o(){if(!t.io)throw new Error(r+"Error: Socket.io isn't loaded yet, scripts has been stoped.");var e=t.io();e.on("greeting",function(t){console.log(r+"Info: WebSocket from now on. :)"),e.emit("thank-you-sir",{info:"啊♂啊♂Thank♂You♂Sir"})})}var r="Animation Searcher ";e.element(window).on("load",o)}(window,window.angular);